# 开发指南

开发过程中若遇到问题，需根据开发指南提出最优解，与用户讨论并达成一致后，再一步一步执行。禁止未经讨论，直接执行。 

## 核心原则
1. **避免"按下葫芦浮起瓢"**
   - 修改前必查文档（`readme.md`）。
   - 关注关键依赖点（会员标识、卡类型、数据验证规则）。
   - 执行检查清单：
     - 修改前：检查影响范围、查看文档、确认验证规则。
     - 修改后：验证相关功能、更新文档、记录修改日志。
   - 保持文档同步，遵循最小修改原则。

2. **避免过度设计和过度优化**
   - 需求驱动设计，保持简洁。
   - 避免过早优化，聚焦核心功能。
   - 采用渐进式优化策略。

3. **问题修复原则**
   - **思维链**：明确问题根本原因，建立逻辑推导链。
   - **数据流**：追踪变量和数据流动，避免盲目修改。
   - **避免无效修改**：每次改动需有清晰依据。

4. **避免无效文件创建**
   - 检查现有文件，优先复用。
   - 明确需求，避免冗余。
   - 记录新建文件的必要性和用途。

---

## 问题排查与修复流程
1. **数据流分析方法**
   - 自上而下：从用户界面追踪到数据库操作。
   - 追踪要点：参数传递、类型转换、错误处理、日志记录。

2. **问题定位策略**
   - 确认问题范围（场景、数据、可重现性）。
   - 分层排查：调用方式 → 业务逻辑 → 底层实现。

3. **修复验证流程**
   - 验证修复效果：运行测试、检查边界条件、验证关联功能。
   - 避免引入新问题：最小修改、向后兼容、完整测试覆盖。

---

## 业务规则
### 会员管理
1. **会员类型**
   - 课时卡（单次卡、两次卡、十次卡）。
   - 月卡（单次月卡、双次月卡）。

2. **身份唯一性**
   - 使用姓名/微信名作为主要标识，重名时使用邮箱验证。

3. **卡类型规则**
   - 课时卡：有剩余课时正常签到，无剩余课时额外签到。
   - 月卡：按每日限制次数签到，过期后均为额外签到。
   - 新会员：在数据库暂无会员信息的会员，为新会员。首次签到为额外签到。

### 签到处理
1. **时间规则**
   - 课程时间：周一到周六（早课、晚课）。
   - 签到时段：当天内均可，支持提前和补签。

2. **重复签到规则**
   - 同一时段禁止重复签到，不同时段按会员卡规则处理。

3. **签到类型**
   - 正常签到：符合会员卡规则。
   - 额外签到：新会员、无卡、超限等特殊情况。

4. **提示信息**
   - 签到成功、额外签到提醒、重复签到、验证失败提示。

---

## 开发规范
### 开发流程
1. **版本控制**
   - 每次提交一个明确功能或修复，提交信息规范。
   - 合并前必须经过代码审查。

2. **开发步骤**
   - 阅读文档 → 分析影响 → 编写测试 → 实现功能 → 代码审查 → 更新文档。

### 代码质量
1. **代码风格**
   - 使用 ESLint 和 Prettier 保持一致性。
   - 使用 TypeScript 确保类型安全。

2. **代码组织**
   - 单一职责、模块化、避免重复代码。



### 测试规范
1. **测试用例维护**
   - 使用动态生成测试数据，避免硬编码。
   - 按功能场景分组，清晰描述测试意图。

2. **测试最佳实践**
   ```typescript
   it('单次月卡会员每天第一次签到应为正常签到', async () => {
     const member = await testManager.createMember({
       name: testManager.generateTestName('test_member'),
       membership: 'single_monthly'
     });
     // 测试实现
   });


**相关文档**
- README.md - 项目概述
- DATABASE.md - 数据库设计
- API_DOCS.md - API文档
- test-review.md - 测试规范